
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Token capture via an llvm-based analysis pass - Diary of a reverse-engineer</title>
  <meta name="author" content="Axel Souchet, Jonathan Salwan, Jérémy Fetiveau">

  
  <meta name="description" content="Introduction About three years ago, the LLVM framework started to pique my interest for a lot of different reasons. This collection of industrial &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://doar-e.github.io/blog/2016/11/27/clang-and-passes">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Diary of a reverse-engineer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/jquery.tableofcontents.min.js" type="text/javascript"></script>
  <script src="/javascripts/generate-toc.js" type="text/javascript"></script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43481215-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <style>
    p { text-align: justify; }
  </style>

</head>
<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><img src="/images/sigle-blanc-250px.jpg"></img>

	<div class="header-title"><a href="/">Diary of a reverse-engineer</a></div>


	<br><div class="header-subtitle">Because we like to play with weird things.</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:doar-e.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/presentations">Presentations</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Token Capture via an Llvm-based Analysis Pass</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2016-11-27T20:43:00-08:00" pubdate data-updated="true">Nov 27<span>th</span>, 2016</time>
        
      </p>
    
  </header>


<div class="entry-content"><h1>Introduction</h1>

<p>About three years ago, the LLVM framework started to pique my interest for a lot of different reasons. This collection of industrial strength compiler technology, as <a href="http://llvm.org/pubs/2008-10-04-ACAT-LLVM-Intro.pdf">Latner</a> said in 2008, was designed in a very modular way. It also looked like it had a lot of interesting features that could be used in a lot of (different) domains: code-optimization (think <a href="https://github.com/JonathanSalwan/Tigress_protection">deobfuscation</a>), (architecture independent) <a href="https://github.com/0vercl0k/articles/blob/master/Obfuscation%20of%20steel%20meet%20Kryptonite.pdf">code obfuscation</a>, static code instrumentation (think <a href="https://github.com/google/sanitizers/wiki">sanitizers</a>), <a href="http://clang-analyzer.llvm.org/index.html">static analysis</a>, for runtime software exploitation mitigations (think <a href="http://clang.llvm.org/docs/ControlFlowIntegrity.html">cfi</a>, <a href="http://clang.llvm.org/docs/SafeStack.html">safestack</a>), power a fuzzing framework (think <a href="http://llvm.org/docs/LibFuzzer.html">libFuzzer</a>), ..you name it.</p>

<p>A lot of the power that came with this giant library was partly because it would operate in mainly three stages, and you were free to hook your code in any of those: front-end, mid-end, back-end. Other strengths included: the high number of back-ends, the documentation, the C/C++ APIs, the community, ease of use compared to gcc (see below from kcc&rsquo;s <a href="https://gcc.gnu.org/wiki/cauldron2012?action=AttachFile&amp;do=get&amp;target=kcc.pdf">presentation</a>), etc.</p>

<p><img class="center" src="/images/token_capture_via_llvm_based_static_analysis_pass/llvmvsgcc.png" title="GCC from a newcomer's perspective" ></p>

<p>The front-end part takes as input source code and generates LLVM IL code, the middle part operates on LLVM IL and finally the last one receives LLVM IL in order to output assembly code and or an executable file.</p>

<p><img class="center" src="/images/token_capture_via_llvm_based_static_analysis_pass/llvm_architecture.png" title="Major components in a three phase compiler" ></p>

<p>In this post we will walk through a simple LLVM pass that does neither optimization, nor obfuscation; but acts more as a token finder for fuzzing purposes.</p>

<div class='entry-content-toc'></div>




<!--more-->


<h1>Background</h1>

<h2>Source of inspiration</h2>

<p>If you haven&rsquo;t heard of the new lcamtuf&rsquo;s coverage-guided fuzzer, it&rsquo;s most likely because you have lived in a cave for the past year or two as it has been basically mentioned everywhere (now on this blog too!). The <a href="https://github.com/mcarpenter/afl">sources</a>, the <a href="http://lcamtuf.coredump.cx/afl/README.txt">documentation</a> and the <a href="https://groups.google.com/forum/#!forum/afl-users">afl-users group</a> are really awesome resources if you&rsquo;d like to know a little bit more and follow its development.</p>

<p>What you have to know for this post though, is that the fuzzer generates test cases and will pick and keep the interesting ones based on the code-coverage that they will exercise. You end-up with a set of test cases covering different part of the code, and can spend more time hammering and mutating a small number of files, instead of a zillion. It is also packed with <a href="https://lcamtuf.blogspot.fr/2015/05/lesser-known-features-of-afl-fuzz.html">clever hacks</a> that just makes it one of the most used/easy fuzzer to use today (don&rsquo;t ask me for proof to back this claim).</p>

<p>In order to measure the code-coverage, the first version of AFL would hook in the compiler toolchain and instrument basic block in the .S files generated by gcc. The instrumentation flips a bit in a bitmap as a sign of &ldquo;I&rsquo;ve executed this part of the code&rdquo;. This tiny per-block static instrumentation (as opposed to DBI based ones) makes it hella fast, and can actually be used while fuzzing without too much of overheard. After a little bit of time, an LLVM based version has been designed (by László Szekeres and lcamtuf) in order to be less hacky, architecture independent (bonus that you get for free when writing a pass), and very elegant (no more reading/modifying raw .S files). The way this has been implemented is hooking into the mid-end in order to statically add the extra instrumentation afl-fuzz needs to have the code-coverage feedback. This is now known as <a href="https://github.com/mirrorer/afl/tree/master/llvm_mode">afl-clang-fast</a>.</p>

<p>A little later, some discussions on the googlegroup led the readers to believe that knowing &ldquo;magics&rdquo; used by a library would make the fuzzing more efficient. If I know all the magics and have a way to detect where they are located in a test-case, then I can use them instead of bit-flipping and hope it would lead to &ldquo;better&rdquo; fuzzing. This list of &ldquo;magics&rdquo; is called a  dictionary. And what I just called &ldquo;magics&rdquo; are &ldquo;tokens&rdquo;. You can provide such a dictionary (list of tokens) to afl via the -X option. In order to ease, automate the process of semi-automatically generate a dictionary file, lcamtuf developed a runtime solution based on <code>LD_PRELOAD</code> and instrumenting calls to memory compare like routines: <code>strcmp</code>, <code>memcmp</code>, etc. If one of the argument comes from a read-only section, then it is most likely a token  and it is most likely a good candidate for the dictionary. This is called <a href="https://groups.google.com/forum/#!msg/afl-users/jiQ9u5Tr5P0/nTTcBGQHCwAJ">afl-tokencap</a>.</p>

<h2>afl-llvm-tokencap</h2>

<p>What if instead of relying on a runtime solution that requires you to:</p>

<ul>
<li>Have built a complete enough corpus to exercise the code that will expose the tokens,</li>
<li>Recompile your target with a set of extra options that tell your compiler to not use the built-ins version of <code>strcmp</code>/<code>strncmp</code>/etc,</li>
<li>Run every test cases through the new binary with the libtokencap <code>LD_PRELOAD</code>&rsquo;d.</li>
</ul>


<p>..we build the dictionary at compile time. The idea behind this, is to have another pass hooking the build process, is looking for tokens at <em>compile</em> time and is building a dictionary ready to use for your first fuzz run. Thanks to LLVM this can be written with less than 400 lines of code. It is also easy to read, easy to write and is architecture independent as it is even running before the back-end.</p>

<p>This is the problem that I will walk you through in this post, AKA yet-another-example-of-llvm-pass. Here we are anyway, an occasion to get back at blogging one might even say!</p>

<p>Before diving in, here what we actually want the pass to do:</p>

<ul>
<li>Walk through every instructions compiled, find all the function calls,</li>
<li>When the function call target is one of the function of interest (<code>strcmp</code>, <code>memcmp</code>, etc), we extract the arguments,</li>
<li>If one of the arguments is an hard-coded string, then we save it as a token in the dictionary being built at compile time.</li>
</ul>


<h1>afl-llvm-tokencap-pass.so.cc</h1>

<p>In case you are already very familiar with LLVM and its pass mechanism, here is <a href="https://github.com/0vercl0k/stuffz/blob/master/llvm-funz/afl-llvm-tokencap-pass.so.cc">afl-llvm-tokencap-pass.so.cc</a> and the <a href="https://github.com/0vercl0k/stuffz/blob/master/llvm-funz/afl-2.31b.patch">afl.patch</a> &ndash; it is about 300 lines of C++ and is pretty straightforward to understand.</p>

<p>Now, for all the others that would like a walk-through the source code let&rsquo;s do it.</p>

<h2>AFLTokenCap class</h2>

<p>The most important part of this file is the <code>AFLTokenCap</code> class which is walking through the LLVM IL instructions looking for tokens. LLVM gives you the possibility to work at <a href="http://llvm.org/docs/WritingAnLLVMPass.html">different granularity levels</a> when writing a pass (more granular to the less granular): BasicBlockPass, FunctionPass, ModulePass, etc. Note that those are not the only ones, there are quite a few others that work slightly differently: MachineFunctionPass, RegionPass, LoopPass, etc.</p>

<p>When you are writing a pass, you write a class that subclasses a <code>*Pass</code> parent class. Doing that means you are expected to implement different virtual methods that will be called under specific circumstances &ndash; but basically you have three functions: <code>doInitialization</code>, <code>runOn*</code> and <code>doFinalization</code>. The first one and the last one are rarely used, but they can provide you a way to execute code once all the basic-blocks have been run through or prior. The <code>runOn*</code> function is important though: this is the function that is going to get called with an LLVM object you are free to walk-through (<em>Analysis</em> passes according to the <a href="http://llvm.org/docs/Passes.html">LLVM nomenclature</a>) or modify (<em>Transformation</em> passes) it. As I said above, the LLVM objects are basically <code>Module</code>/<code>Function</code>/<code>BasicBlock</code> instances. In case it is not that obvious, a <code>Module</code> (a <code>.c</code> file) is made of <code>Function</code>s, and a <code>Function</code> is made of <code>BasicBlock</code>s, and a <code>BasicBlock</code> is a set of <code>Instruction</code>s. I also suggest you take a look at the <a href="http://llvm.org/docs/WritingAnLLVMPass.html#writing-an-llvm-pass-basiccode">HelloWorld pass</a> from the LLVM wiki, it should give you another simple example to wrap your head around the concept of pass.</p>

<p>For today&rsquo;s use-case I have chosen to subclass <code>BasicBlockPass</code> because our analysis doesn&rsquo;t need anything else than a <code>BasicBlock</code> to work. This is the case because we are mainly interested to capture certain arguments passed to certain function calls. Here is what looks like a function call in the <a href="http://llvm.org/docs/LangRef.html">LLVM IR</a> world:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>%retval = call i32 @test(i32 %argc)
</span><span class='line'>call i32 (i8*, ...)* @printf(i8* %msg, i32 12, i8 42)   ; yields i32
</span><span class='line'>%X = tail call i32 @foo()                               ; yields i32
</span><span class='line'>%Y = tail call fastcc i32 @foo()                        ; yields i32
</span><span class='line'>call void %foo(i8 97 signext)
</span><span class='line'>
</span><span class='line'>%struct.A = type { i32, i8 }
</span><span class='line'>%r = call %struct.A @foo()             ; yields { i32, i8 }
</span><span class='line'>%gr = extractvalue %struct.A %r, 0     ; yields i32
</span><span class='line'>%gr1 = extractvalue %struct.A %r, 1    ; yields i8
</span><span class='line'>%Z = call void @foo() noreturn         ; indicates that %foo never returns normally
</span><span class='line'>%ZZ = call zeroext i32 @bar()          ; Return value is %zero extended
</span></code></pre></td></tr></table></div></figure>


<p>Every time <code>AFLTokenCap::runOnBasicBlock</code> is called, the LLVM mid-end will call into our analysis pass (either statically linked into clang/opt or will dynamically load it) with a <code>BasicBlock</code> passed by reference. From there, we can iterate through the set of instructions contained in the basic block and find the <a href="http://llvm.org/docs/LangRef.html#call-instruction">call</a> instructions. Every instructions subclass the top level <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Instruction.html">llvm::Instruction</a> class &ndash; in order to filter you can use the <code>dyn_cast&lt;T&gt;</code> template function that works like the <code>dynamic_cast&lt;T&gt;</code> operator but does not rely on RTTI (and is more efficient &ndash; according to the <a href="http://llvm.org/docs/CodingStandards.html">LLVM coding standards</a>). Used in conjunction with a <a href="http://en.cppreference.com/w/cpp/language/range-for">range-based for loop</a> on the <code>BasicBlock</code> object you can iterate through all the instructions you want.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">bool</span> <span class="n">AFLTokenCap</span><span class="o">::</span><span class="n">runOnBasicBlock</span><span class="p">(</span><span class="n">BasicBlock</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">I_</span> <span class="o">:</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Handle calls to functions of interest */</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">CallInst</span> <span class="o">*</span><span class="n">I</span> <span class="o">=</span> <span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">CallInst</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">I_</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// [...]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once we have found a <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1CallInst.html">llvm::CallInst</a> instance, we need to:</p>

<ul>
<li>Get the name of the called function, assuming it is not an indirect target: <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1CallInst.html#a0bcd4131e1a1d92215f5385b4e16cd2e">llvm::CallInst::getCalledFunction</a></li>
<li>Further the analysis only if only it is a <a href="https://github.com/0vercl0k/stuffz/blob/master/llvm-funz/afl-llvm-tokencap-pass.so.cc#L193">function of interest</a>: <code>strcmp</code>, <code>strncmp</code>, <code>strcasecmp</code>, <code>strncasecmp</code>, <code>memcmp</code></li>
<li>Extract the arguments passed to the function: <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1CallInst.html#ac88b95273e6c753188f6a54d65548579">llvm::CallInst::getNumArgOperands</a>, <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">llvm::CallInst::getArgOperand</a></li>
<li>Detect hard-coded strings (we will consider a subset of them as tokens)</li>
</ul>


<p>Not sure you have noticed yet, but all the objects we are playing with are not only subclassed from <code>llvm::Instruction</code>. You also have to deal with <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Value.html">llvm::Value</a> which is an even more top-level class (<code>llvm::Instruction</code> is a child of <code>llvm::Value</code>). But <code>llvm::Value</code> is also used to represent constants: think of hard-coded strings, integers, etc.</p>

<h2>Detecting hard-coded strings</h2>

<p>In order to detect hard-coded strings in the arguments passed to function calls, I decided to filter out the <code>llvm::ConstantExpr</code>. As its name suggests, this class handles &ldquo;a constant value that is initialized with an expression using other constant values&rdquo;.</p>

<p>The end goal, is to find <code>llvm::ConstantDataArray</code>s and to retrieve their raw values &ndash; those will be the hard-coded strings we are looking for.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>/home/over/workz/afl-2.35b/afl-clang-fast -c -W -Wall -O3 -funroll-loops   -fPIC -o png.pic.o png.c
</span><span class='line'>[...]
</span><span class='line'>afl-llvm-tokencap-pass 2.35b by &lt;0vercl0k@tuxfamily.org&gt;
</span><span class='line'>[...]
</span><span class='line'>[+] Call to memcmp with constant &quot;\x00\x00\xf6\xd6\x00\x01\x00\x00\x00\x00\xd3&quot; found in png.c/png_icc_check_header
</span></code></pre></td></tr></table></div></figure>


<p>At this point, the pass basically does what the token capture library is able to do.</p>

<h2>Harvesting integer immediate</h2>

<p>After playing around with it on libpng though, I quickly was wondering why the pass would not extract all the constants I could find in <a href="https://github.com/rc0r/afl-fuzz/blob/master/dictionaries/png.dict">one of the dictionary</a> already generated and shipped with afl:</p>

<figure class='code'><figcaption><span>png.dict</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>section_IDAT=&quot;IDAT&quot;
</span><span class='line'>section_IEND=&quot;IEND&quot;
</span><span class='line'>section_IHDR=&quot;IHDR&quot;
</span><span class='line'>section_PLTE=&quot;PLTE&quot;
</span><span class='line'>section_bKGD=&quot;bKGD&quot;
</span><span class='line'>section_cHRM=&quot;cHRM&quot;
</span><span class='line'>section_fRAc=&quot;fRAc&quot;
</span><span class='line'>section_gAMA=&quot;gAMA&quot;
</span><span class='line'>section_gIFg=&quot;gIFg&quot;
</span><span class='line'>section_gIFt=&quot;gIFt&quot;
</span><span class='line'>section_gIFx=&quot;gIFx&quot;
</span><span class='line'>section_hIST=&quot;hIST&quot;
</span><span class='line'>section_iCCP=&quot;iCCP&quot;
</span><span class='line'>section_iTXt=&quot;iTXt&quot;
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>Some of those can be found in the function <a href="https://github.com/glennrp/libpng/blob/libpng16/pngpread.c#L226">png_push_read_chunk</a> in the file <a href="https://github.com/glennrp/libpng/blob/libpng16/pngpread.c">pngpread.c</a> for example:</p>

<figure class='code'><figcaption><span>png_push_read_chunk</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define png_IHDR PNG_U32( 73,  72,  68,  82)</span>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">chunk_name</span> <span class="o">==</span> <span class="n">png_IHDR</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">push_length</span> <span class="o">!=</span> <span class="mi">13</span><span class="p">)</span>
</span><span class='line'>     <span class="n">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;Invalid IHDR length&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">PNG_PUSH_SAVE_BUFFER_IF_FULL</span>
</span><span class='line'>  <span class="nf">png_handle_IHDR</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">push_length</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">chunk_name</span> <span class="o">==</span> <span class="n">png_IEND</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">PNG_PUSH_SAVE_BUFFER_IF_FULL</span>
</span><span class='line'>  <span class="n">png_handle_IEND</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">push_length</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">process_mode</span> <span class="o">=</span> <span class="n">PNG_READ_DONE_MODE</span><span class="p">;</span>
</span><span class='line'>  <span class="n">png_push_have_end</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="n">info_ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">chunk_name</span> <span class="o">==</span> <span class="n">png_PLTE</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">PNG_PUSH_SAVE_BUFFER_IF_FULL</span>
</span><span class='line'>  <span class="n">png_handle_PLTE</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">push_length</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to also grab those guys, I have decided to add the support for compare instructions with integer immediate (in one of the operand). Again, thanks to LLVM this is really easy to pull that off: we just need to find the <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1ICmpInst.html">llvm::ICmpInst</a> instructions. The only thing to keep in mind is  false positives. In order to lower the false positives rate, I have chosen to consider an integer immediate as a token only if only it is fully ASCII (like the <code>libpng</code> tokens above)</p>

<p>We can even push it a bit more, and handle switch statements via the same strategy. The only additional step is to retrieve every <code>cases</code> from in the <code>switch</code> statement: <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1SwitchInst.html#a8e7005748409a956c8875e259716559b">llvm::SwitchInst::cases</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Handle switch/case with integer immediates */</span>
</span><span class='line'><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SwitchInst</span> <span class="o">*</span><span class="n">SI</span> <span class="o">=</span> <span class="n">dyn_cast</span><span class="o">&lt;</span><span class="n">SwitchInst</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">I_</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">CIT</span> <span class="o">:</span> <span class="n">SI</span><span class="o">-&gt;</span><span class="n">cases</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ConstantInt</span> <span class="o">*</span><span class="n">CI</span> <span class="o">=</span> <span class="n">CIT</span><span class="p">.</span><span class="n">getCaseValue</span><span class="p">();</span>
</span><span class='line'>    <span class="n">dump_integer_token</span><span class="p">(</span><span class="n">CI</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Limitations</h2>

<p>The main limitation is that as you are supposed to run the pass as part of the compilation process, it is most likely going to end-up compiling tests or utilities that the library ships with. Now, this is annoying as it may add some noise to your tokens &ndash; especially with utility programs. Those ones usually parse input arguments and some use <code>strcmp</code> like function with hard-coded strings to do their parsing.</p>

<p>A partial solution (as in, it reduces the noise, but does not remove it entirely) I have implemented is just to not process any functions called <code>main</code>. Most of the cases I have seen (the set of samples is pretty small I won&rsquo;t lie >:]), this argument parsing is made in the <code>main</code> function and it is very easy to not process it by blacklisting it as you can see below:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="kt">bool</span> <span class="n">AFLTokenCap</span><span class="o">::</span><span class="n">runOnBasicBlock</span><span class="p">(</span><span class="n">BasicBlock</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="c1">// [...]</span>
</span><span class='line'>  <span class="n">Function</span> <span class="o">*</span><span class="n">F</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">getParent</span><span class="p">();</span>
</span><span class='line'>  <span class="n">m_FunctionName</span> <span class="o">=</span> <span class="n">F</span><span class="o">-&gt;</span><span class="n">hasName</span><span class="p">()</span> <span class="o">?</span> <span class="n">F</span><span class="o">-&gt;</span><span class="n">getName</span><span class="p">().</span><span class="n">data</span><span class="p">()</span> <span class="o">:</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">m_FunctionName</span><span class="p">,</span> <span class="s">&quot;main&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Another thing I wanted to experiment on, but did not, was to provide a regular expression like string (think &ldquo;test/*&rdquo;) and not process every files/path that are matching it. You could easily blacklist a whole directory of tests with this.</p>

<h2>Demo</h2>

<p>I have not spent much time trying it out on a lot of code-bases (feel free to send me your feedbacks if you run it on yours though!), but here are some example results with various degree of success.. or not. Starting with <code>libpng</code>:</p>

<figure class='code'><figcaption><span>lpng</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>over@bubuntu:~/workz/lpng1625$ AFL_TOKEN_FILE=/tmp/png.dict make
</span><span class='line'>cp scripts/pnglibconf.h.prebuilt pnglibconf.h
</span><span class='line'>/home/over/workz/afl-2.35b/afl-clang-fast -c -I../zlib  -W -Wall -O3 -funroll-loops   -o png.o png.c
</span><span class='line'>afl-clang-fast 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>afl-llvm-tokencap-pass 2.35b by &lt;0vercl0k@tuxfamily.org&gt;
</span><span class='line'>afl-llvm-pass 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>[+] Instrumented 945 locations (non-hardened mode, ratio 100%).
</span><span class='line'>[+] Found alphanum constant &quot;acsp&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Call to memcmp with constant &quot;\x00\x00\xf6\xd6\x00\x01\x00\x00\x00\x00\xd3&quot; found in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;RGB &quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;GRAY&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;scnr&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;mntr&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;prtr&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;spac&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;abst&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;link&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;nmcl&quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;XYZ &quot; in png.c/png_icc_check_header
</span><span class='line'>[+] Found alphanum constant &quot;Lab &quot; in png.c/png_icc_check_header
</span><span class='line'>[...]
</span><span class='line'>over@bubuntu:~/workz/lpng1625$ sort -u /tmp/png.dict
</span><span class='line'>&quot;abst&quot;
</span><span class='line'>&quot;acsp&quot;
</span><span class='line'>&quot;bKGD&quot;
</span><span class='line'>&quot;cHRM&quot;
</span><span class='line'>&quot;gAMA&quot;
</span><span class='line'>&quot;GRAY&quot;
</span><span class='line'>&quot;hIST&quot;
</span><span class='line'>&quot;iCCP&quot;
</span><span class='line'>&quot;IDAT&quot;
</span><span class='line'>&quot;IEND&quot;
</span><span class='line'>&quot;IHDR&quot;
</span><span class='line'>&quot;iTXt&quot;
</span><span class='line'>&quot;Lab &quot;
</span><span class='line'>&quot;link&quot;
</span><span class='line'>&quot;mntr&quot;
</span><span class='line'>&quot;nmcl&quot;
</span><span class='line'>&quot;oFFs&quot;
</span><span class='line'>&quot;pCAL&quot;
</span><span class='line'>&quot;pHYs&quot;
</span><span class='line'>&quot;PLTE&quot;
</span><span class='line'>&quot;prtr&quot;
</span><span class='line'>&quot;RGB &quot;
</span><span class='line'>&quot;sBIT&quot;
</span><span class='line'>&quot;sCAL&quot;
</span><span class='line'>&quot;scnr&quot;
</span><span class='line'>&quot;spac&quot;
</span><span class='line'>&quot;sPLT&quot;
</span><span class='line'>&quot;sRGB&quot;
</span><span class='line'>&quot;tEXt&quot;
</span><span class='line'>&quot;tIME&quot;
</span><span class='line'>&quot;tRNS&quot;
</span><span class='line'>&quot;\x00\x00\xf6\xd6\x00\x01\x00\x00\x00\x00\xd3&quot;
</span><span class='line'>&quot;XYZ &quot;
</span><span class='line'>&quot;zTXt&quot;
</span></code></pre></td></tr></table></div></figure>


<p>On <a href="https://github.com/mackyle/sqlite">sqlite3</a> (<a href="">sqlite.dict</a>):</p>

<figure class='code'><figcaption><span>sqlite3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>over@bubuntu:~/workz/sqlite3$ AFL_TOKEN_FILE=/tmp/sqlite.dict [/home/over/workz/afl-2.35b/afl-clang-fast stub.c sqlite3.c -lpthread -ldl -o a.out
</span><span class='line'>[...]
</span><span class='line'>afl-llvm-tokencap-pass 2.35b by &lt;0vercl0k@tuxfamily.org&gt;
</span><span class='line'>afl-llvm-pass 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>[+] Instrumented 47546 locations (non-hardened mode, ratio 100%).
</span><span class='line'>[+] Call to strcmp with constant &quot;unix-excl&quot; found in sqlite3.c/unixOpen
</span><span class='line'>[+] Call to memcmp with constant &quot;SQLite format 3&quot; found in sqlite3.c/sqlite3BtreeBeginTrans
</span><span class='line'>[+] Call to memcmp with constant &quot;@  &quot; found in sqlite3.c/sqlite3BtreeBeginTrans
</span><span class='line'>[+] Call to strcmp with constant &quot;BINARY&quot; found in sqlite3.c/sqlite3_step
</span><span class='line'>[+] Call to strcmp with constant &quot;:memory:&quot; found in sqlite3.c/sqlite3BtreeOpen
</span><span class='line'>[+] Call to strcmp with constant &quot;nolock&quot; found in sqlite3.c/sqlite3BtreeOpen
</span><span class='line'>[+] Call to strcmp with constant &quot;immutable&quot; found in sqlite3.c/sqlite3BtreeOpen
</span><span class='line'>[+] Call to memcmp with constant &quot;\xd9\xd5\x05\xf9 \xa1c&quot; found in sqlite3.c/syncJournal
</span><span class='line'>[+] Found alphanum constant &quot;char&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;clob&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;text&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;blob&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;real&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;floa&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Found alphanum constant &quot;doub&quot; in sqlite3.c/yy_reduce
</span><span class='line'>[+] Call to strcmp with constant &quot;sqlite_sequence&quot; found in sqlite3.c/sqlite3StartTable
</span><span class='line'>[+] Call to memcmp with constant &quot;file:&quot; found in sqlite3.c/sqlite3ParseUri
</span><span class='line'>[+] Call to memcmp with constant &quot;localhost&quot; found in sqlite3.c/sqlite3ParseUri
</span><span class='line'>[+] Call to memcmp with constant &quot;vfs&quot; found in sqlite3.c/sqlite3ParseUri
</span><span class='line'>[+] Call to memcmp with constant &quot;cache&quot; found in sqlite3.c/sqlite3ParseUri
</span><span class='line'>[+] Call to memcmp with constant &quot;mode&quot; found in sqlite3.c/sqlite3ParseUri
</span><span class='line'>[+] Call to strcmp with constant &quot;localtime&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;unixepoch&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strncmp with constant &quot;weekday &quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strncmp with constant &quot;start of &quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;month&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;year&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;hour&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;minute&quot; found in sqlite3.c/isDate
</span><span class='line'>[+] Call to strcmp with constant &quot;second&quot; found in sqlite3.c/isDate
</span><span class='line'>over@bubuntu:~/workz/sqlite3$ sort -u /tmp/sqlite.dict
</span><span class='line'>&quot;@  &quot;
</span><span class='line'>&quot;BINARY&quot;
</span><span class='line'>&quot;blob&quot;
</span><span class='line'>&quot;cache&quot;
</span><span class='line'>&quot;char&quot;
</span><span class='line'>&quot;clob&quot;
</span><span class='line'>&quot;doub&quot;
</span><span class='line'>&quot;file:&quot;
</span><span class='line'>&quot;floa&quot;
</span><span class='line'>&quot;hour&quot;
</span><span class='line'>&quot;immutable&quot;
</span><span class='line'>&quot;localhost&quot;
</span><span class='line'>&quot;localtime&quot;
</span><span class='line'>&quot;:memory:&quot;
</span><span class='line'>&quot;minute&quot;
</span><span class='line'>&quot;mode&quot;
</span><span class='line'>&quot;month&quot;
</span><span class='line'>&quot;nolock&quot;
</span><span class='line'>&quot;real&quot;
</span><span class='line'>&quot;second&quot;
</span><span class='line'>&quot;SQLite format 3&quot;
</span><span class='line'>&quot;sqlite_sequence&quot;
</span><span class='line'>&quot;start of &quot;
</span><span class='line'>&quot;text&quot;
</span><span class='line'>&quot;unixepoch&quot;
</span><span class='line'>&quot;unix-excl&quot;
</span><span class='line'>&quot;vfs&quot;
</span><span class='line'>&quot;weekday &quot;
</span><span class='line'>&quot;\xd9\xd5\x05\xf9 \xa1c&quot;
</span><span class='line'>&quot;year&quot;
</span></code></pre></td></tr></table></div></figure>


<p>On <a href="https://github.com/GNOME/libxml2">libxml2</a> (here is a library with a lot of test cases / utilities that raises the noise ratio in the tokens extracted &ndash; cf <code>xmlShell*</code> for example):</p>

<figure class='code'><figcaption><span>libxml2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>over@bubuntu:~/workz/libxml2$ CC=/home/over/workz/afl-2.35b/afl-clang-fast ./autogen.sh &amp;&amp; AFL_TOKEN_FILE=/tmp/xml.dict make
</span><span class='line'>[...]
</span><span class='line'>afl-clang-fast 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>afl-llvm-tokencap-pass 2.35b by &lt;0vercl0k@tuxfamily.org&gt;
</span><span class='line'>afl-llvm-pass 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>[+] Instrumented 668 locations (non-hardened mode, ratio 100%).
</span><span class='line'>[+] Call to strcmp with constant &quot;UTF-8&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UTF8&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UTF-16&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UTF16&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-10646-UCS-2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UCS-2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UCS2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-10646-UCS-4&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UCS-4&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;UCS4&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-1&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-LATIN-1&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO LATIN 1&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-LATIN-2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO LATIN 2&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-3&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-4&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-5&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-6&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-7&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-8&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-8859-9&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;ISO-2022-JP&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;SHIFT_JIS&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;EUC-JP&quot; found in encoding.c/xmlParseCharEncoding__internal_alias
</span><span class='line'>[...]
</span><span class='line'>afl-clang-fast 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>afl-llvm-tokencap-pass 2.35b by &lt;0vercl0k@tuxfamily.org&gt;
</span><span class='line'>afl-llvm-pass 2.35b by &lt;lszekeres@google.com&gt;
</span><span class='line'>[+] Instrumented 1214 locations (non-hardened mode, ratio 100%).
</span><span class='line'>[+] Call to strcmp with constant &quot;exit&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;quit&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;help&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;validate&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;load&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;relaxng&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;save&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;write&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;grep&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;free&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;base&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;setns&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;setrootns&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;xpath&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;setbase&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[+] Call to strcmp with constant &quot;whereis&quot; found in debugXML.c/xmlShell__internal_alias
</span><span class='line'>[...]
</span><span class='line'>over@bubuntu:~/workz/libxml2$ sort -u /tmp/xml.dict
</span><span class='line'>&quot;307377&quot;
</span><span class='line'>&quot;base&quot;
</span><span class='line'>&quot;c14n&quot;
</span><span class='line'>&quot;catalog&quot;
</span><span class='line'>&quot;&lt;![CDATA[&quot;
</span><span class='line'>&quot;chvalid&quot;
</span><span class='line'>&quot;crazy:&quot;
</span><span class='line'>&quot;debugXML&quot;
</span><span class='line'>&quot;dict&quot;
</span><span class='line'>&quot;disable SAX&quot;
</span><span class='line'>&quot;document&quot;
</span><span class='line'>&quot;encoding&quot;
</span><span class='line'>&quot;entities&quot;
</span><span class='line'>&quot;EUC-JP&quot;
</span><span class='line'>&quot;exit&quot;
</span><span class='line'>&quot;fetch external entities&quot;
</span><span class='line'>&quot;file:///etc/xml/catalog&quot;
</span><span class='line'>&quot;free&quot;
</span><span class='line'>&quot;ftp://&quot;
</span><span class='line'>&quot;gather line info&quot;
</span><span class='line'>&quot;grep&quot;
</span><span class='line'>&quot;hash&quot;
</span><span class='line'>&quot;help&quot;
</span><span class='line'>&quot;HTMLparser&quot;
</span><span class='line'>&quot;HTMLtree&quot;
</span><span class='line'>&quot;http&quot;
</span><span class='line'>&quot;HTTP/&quot;
</span><span class='line'>&quot;huge:&quot;
</span><span class='line'>&quot;huge:attrNode&quot;
</span><span class='line'>&quot;huge:commentNode&quot;
</span><span class='line'>&quot;huge:piNode&quot;
</span><span class='line'>&quot;huge:textNode&quot;
</span><span class='line'>&quot;is html&quot;
</span><span class='line'>&quot;ISO-10646-UCS-2&quot;
</span><span class='line'>&quot;ISO-10646-UCS-4&quot;
</span><span class='line'>&quot;ISO-2022-JP&quot;
</span><span class='line'>&quot;ISO-8859-1&quot;
</span><span class='line'>&quot;ISO-8859-2&quot;
</span><span class='line'>&quot;ISO-8859-3&quot;
</span><span class='line'>&quot;ISO-8859-4&quot;
</span><span class='line'>&quot;ISO-8859-5&quot;
</span><span class='line'>&quot;ISO-8859-6&quot;
</span><span class='line'>&quot;ISO-8859-7&quot;
</span><span class='line'>&quot;ISO-8859-8&quot;
</span><span class='line'>&quot;ISO-8859-9&quot;
</span><span class='line'>&quot;ISO LATIN 1&quot;
</span><span class='line'>&quot;ISO-LATIN-1&quot;
</span><span class='line'>&quot;ISO LATIN 2&quot;
</span><span class='line'>&quot;ISO-LATIN-2&quot;
</span><span class='line'>&quot;is standalone&quot;
</span><span class='line'>&quot;is valid&quot;
</span><span class='line'>&quot;is well formed&quot;
</span><span class='line'>&quot;keep blanks&quot;
</span><span class='line'>&quot;list&quot;
</span><span class='line'>&quot;load&quot;
</span><span class='line'>&quot;nanoftp&quot;
</span><span class='line'>&quot;nanohttp&quot;
</span><span class='line'>&quot;parser&quot;
</span><span class='line'>&quot;parserInternals&quot;
</span><span class='line'>&quot;pattern&quot;
</span><span class='line'>&quot;quit&quot;
</span><span class='line'>&quot;relaxng&quot;
</span><span class='line'>&quot;save&quot;
</span><span class='line'>&quot;SAX2&quot;
</span><span class='line'>&quot;SAX block&quot;
</span><span class='line'>&quot;SAX function attributeDecl&quot;
</span><span class='line'>&quot;SAX function cdataBlock&quot;
</span><span class='line'>&quot;SAX function characters&quot;
</span><span class='line'>&quot;SAX function comment&quot;
</span><span class='line'>&quot;SAX function elementDecl&quot;
</span><span class='line'>&quot;SAX function endDocument&quot;
</span><span class='line'>&quot;SAX function endElement&quot;
</span><span class='line'>&quot;SAX function entityDecl&quot;
</span><span class='line'>&quot;SAX function error&quot;
</span><span class='line'>&quot;SAX function externalSubset&quot;
</span><span class='line'>&quot;SAX function fatalError&quot;
</span><span class='line'>&quot;SAX function getEntity&quot;
</span><span class='line'>&quot;SAX function getParameterEntity&quot;
</span><span class='line'>&quot;SAX function hasExternalSubset&quot;
</span><span class='line'>&quot;SAX function hasInternalSubset&quot;
</span><span class='line'>&quot;SAX function ignorableWhitespace&quot;
</span><span class='line'>&quot;SAX function internalSubset&quot;
</span><span class='line'>&quot;SAX function isStandalone&quot;
</span><span class='line'>&quot;SAX function notationDecl&quot;
</span><span class='line'>&quot;SAX function reference&quot;
</span><span class='line'>&quot;SAX function resolveEntity&quot;
</span><span class='line'>&quot;SAX function setDocumentLocator&quot;
</span><span class='line'>&quot;SAX function startDocument&quot;
</span><span class='line'>&quot;SAX function startElement&quot;
</span><span class='line'>&quot;SAX function unparsedEntityDecl&quot;
</span><span class='line'>&quot;SAX function warning&quot;
</span><span class='line'>&quot;schemasInternals&quot;
</span><span class='line'>&quot;schematron&quot;
</span><span class='line'>&quot;setbase&quot;
</span><span class='line'>&quot;setns&quot;
</span><span class='line'>&quot;setrootns&quot;
</span><span class='line'>&quot;SHIFT_JIS&quot;
</span><span class='line'>&quot;sql:&quot;
</span><span class='line'>&quot;substitute entities&quot;
</span><span class='line'>&quot;test/threads/invalid.xml&quot;
</span><span class='line'>&quot;total&quot;
</span><span class='line'>&quot;tree&quot;
</span><span class='line'>&quot;tutor10_1&quot;
</span><span class='line'>&quot;tutor10_2&quot;
</span><span class='line'>&quot;tutor3_2&quot;
</span><span class='line'>&quot;tutor8_2&quot;
</span><span class='line'>&quot;UCS-2&quot;
</span><span class='line'>&quot;UCS2&quot;
</span><span class='line'>&quot;UCS-4&quot;
</span><span class='line'>&quot;UCS4&quot;
</span><span class='line'>&quot;user data&quot;
</span><span class='line'>&quot;UTF-16&quot;
</span><span class='line'>&quot;UTF16&quot;
</span><span class='line'>&quot;UTF-16BE&quot;
</span><span class='line'>&quot;UTF-16LE&quot;
</span><span class='line'>&quot;UTF-8&quot;
</span><span class='line'>&quot;UTF8&quot;
</span><span class='line'>&quot;valid&quot;
</span><span class='line'>&quot;validate&quot;
</span><span class='line'>&quot;whereis&quot;
</span><span class='line'>&quot;write&quot;
</span><span class='line'>&quot;xinclude&quot;
</span><span class='line'>&quot;xmlautomata&quot;
</span><span class='line'>&quot;xmlerror&quot;
</span><span class='line'>&quot;xmlIO&quot;
</span><span class='line'>&quot;xmlmodule&quot;
</span><span class='line'>&quot;xmlreader&quot;
</span><span class='line'>&quot;xmlregexp&quot;
</span><span class='line'>&quot;xmlsave&quot;
</span><span class='line'>&quot;xmlschemas&quot;
</span><span class='line'>&quot;xmlschemastypes&quot;
</span><span class='line'>&quot;xmlstring&quot;
</span><span class='line'>&quot;xmlunicode&quot;
</span><span class='line'>&quot;xmlwriter&quot;
</span><span class='line'>&quot;xpath&quot;
</span><span class='line'>&quot;xpathInternals&quot;
</span><span class='line'>&quot;xpointer&quot;
</span></code></pre></td></tr></table></div></figure>


<p>Performance wise &ndash; here is what we are looking at on <code>libpng</code> (+0.283s):</p>

<figure class='code'><figcaption><span>time difference on lpng</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>over@bubuntu:~/workz/lpng1625$ make clean &amp;&amp; time AFL_TOKEN_FILE=/tmp/png.dict make &amp;&amp; make clean &amp;&amp; time make
</span><span class='line'>[...]
</span><span class='line'>real    0m12.320s
</span><span class='line'>user    0m11.732s
</span><span class='line'>sys     0m0.360s
</span><span class='line'>[...]
</span><span class='line'>real    0m12.037s
</span><span class='line'>user    0m11.436s
</span><span class='line'>sys     0m0.384s
</span></code></pre></td></tr></table></div></figure>


<h1>Last words</h1>

<p>I am very interested in hearing from you if you give a shot to this analysis pass on your code-base and / or your fuzzing sessions, so feel free to hit me up! Also, note that <a href="http://llvm.org/docs/LibFuzzer.html">libfuzzer</a> supports the same feature and is compatible with afl&rsquo;s dictionary syntax &ndash; so you get it for free!</p>

<p>Here is a list of interesting articles talking about transformation/analysis passes that I recommend you read if you want to know more:</p>

<ul>
<li><a href="http://blog.quarkslab.com/turning-regular-code-into-atrocities-with-llvm.html">Turning Regular Code Into Atrocities With LLVM</a></li>
<li><a href="https://github.com/0vercl0k/stuffz/blob/master/llvm-funz/kryptonite/llvm-functionpass-kryptonite-obfuscater.cpp">llvm-functionpass-kryptonite-obfuscater.cpp</a></li>
<li><a href="https://github.com/quarkslab/llvm-passes">quarkslab/llvm-passes</a></li>
<li><a href="https://github.com/llvm-mirror/llvm/tree/master/lib/Analysis">llvm/lib/Analysis</a></li>
<li><a href="https://github.com/llvm-mirror/llvm/tree/master/lib/Transforms">llvm/lib/Transforms</a></li>
</ul>


<p>Special shout-outs to my proofreaders: <a href="https://twitter.com/yrp604">yrp</a>, <a href="https://twitter.com/mongobug">mongo</a> &amp; <a href="https://twitter.com/JonathanSalwan">jonathan</a>.</p>

<p>Go hax clang and or LLVM!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Axel "0vercl0k" Souchet</span></span>

      








  


<time datetime="2016-11-27T20:43:00-08:00" pubdate data-updated="true">Nov 27<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/analysis-pass/'>analysis pass</a>, <a class='category' href='/blog/categories/clang/'>clang</a>, <a class='category' href='/blog/categories/fuzzing/'>fuzzing</a>, <a class='category' href='/blog/categories/llvm/'>llvm</a>, <a class='category' href='/blog/categories/pass/'>pass</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/08/18/keygenning-with-klee/" title="Previous Post: Keygenning with KLEE">&laquo; Keygenning with KLEE</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/12/21/happy-unikernels/" title="Next Post: happy unikernels">happy unikernels &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/08/05/binary-rewriting-with-syzygy/">Binary rewriting with syzygy, Pt. I</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/21/happy-unikernels/">happy unikernels</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/27/clang-and-passes/">Token capture via an llvm-based analysis pass</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/keygenning-with-klee/">Keygenning with KLEE</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/08/spotlight-on-an-unprotected-aes128-whitebox-implementation/">Spotlight on an unprotected AES128 white-box implementation</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 -  Axel Souchet, Jonathan Salwan, Jérémy Fetiveau <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  












  <script type="text/javascript">
  jQuery(document).ready(function() {
    // Put a TOC right before the entry content.
    if(jQuery('div[id="tocBlock"]').length == 0)
        generateTOC('.entry-content-toc', null);
  });
  </script>

</body>
</html>
